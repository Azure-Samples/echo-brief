import{u as M,r,j as e,A as J}from"./index-CDPrMl7K.js";import{T as _,U as q,R as G,B as O,C as I}from"./badge-BhjBTh9v.js";import{c as j,B as p,a as X}from"./button-DKvy1mVZ.js";import{C as T,b as C,c as E,a as S}from"./card-93D8wC93.js";import{T as W,a as K,b as P,c as D}from"./tabs-Cz9Ix9Om.js";import{T as Q,J as Y}from"./apiConstants-5F4MNVxx.js";import{F as Z,a as $}from"./file-text-D6Q4wcx8.js";import"./index-SflWdvsn.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],se=j("ArrowLeft",ee);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],A=j("Download",ae);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],re=j("Pause",te);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]],ie=j("Play",ne);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],le=j("Volume2",oe);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],de=j("VolumeX",ce),z={completed:"bg-green-500 text-white border border-green-700 shadow-md px-4 py-1 rounded-full",processing:"bg-yellow-500 text-black border border-yellow-600 shadow-md px-4 py-1 rounded-full",uploaded:"bg-blue-500 text-white border border-blue-700 shadow-md px-4 py-1 rounded-full",failed:"bg-red-500 text-white border border-red-700 shadow-md px-4 py-1 rounded-full",error:"bg-red-500 text-white border border-red-700 shadow-md px-4 py-1 rounded-full",default:"bg-gray-500 text-white border border-gray-600 shadow-md px-4 py-1 rounded-full"};function me({recording:a}){const c=M(),[y,l]=r.useState(null),[f,d]=r.useState(!1),[m,v]=r.useState(!1),[g,u]=r.useState(0),[x,k]=r.useState(0),[N,R]=r.useState(75),n=r.useRef(null);r.useEffect(()=>{},[a.transcription_file_path]),r.useEffect(()=>{const s=n.current;if(!s)return;const t=()=>{u(s.currentTime)},i=()=>{k(s.duration)},w=()=>{d(!1)};return s.addEventListener("timeupdate",t),s.addEventListener("loadedmetadata",i),s.addEventListener("ended",w),()=>{s.removeEventListener("timeupdate",t),s.removeEventListener("loadedmetadata",i),s.removeEventListener("ended",w)}},[]),r.useEffect(()=>{const s=n.current;s&&(f?s.play().catch(t=>{console.error("Error playing audio:",t),d(!1)}):s.pause())},[f]),r.useEffect(()=>{const s=n.current;s&&(s.muted=m)},[m]),r.useEffect(()=>{const s=n.current;s&&(s.volume=N/100)},[N]);const o=s=>{const t=Math.floor(s/60),i=Math.floor(s%60);return`${t}:${i.toString().padStart(2,"0")}`},h=()=>{d(!f)},b=()=>{v(!m)},B=s=>{const t=Number(s.target.value);u(t),n.current&&(n.current.currentTime=t)},F=s=>{const t=Number(s.target.value);R(t)},L=()=>{c.history.back()};return e.jsxs("div",{className:"relative container mx-auto px-4 py-6",children:[e.jsx("div",{className:"mb-6 flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"outline",size:"icon",onClick:L,children:e.jsx(se,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Audio Recording Details"}),e.jsxs("div",{className:"text-muted-foreground flex items-center gap-1 text-sm",children:[e.jsx("span",{className:"cursor-pointer hover:underline",onClick:L,children:"Recordings"}),e.jsx("span",{children:"/"}),e.jsx("span",{children:a.id})]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:e.jsxs("div",{className:"space-y-6 lg:col-span-3",children:[e.jsxs(T,{children:[e.jsx(C,{className:"pb-3",children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-primary/10 rounded-full p-2",children:e.jsx(Z,{className:"text-primary h-5 w-5"})}),"Recording"]})}),e.jsxs(S,{children:[e.jsx("audio",{ref:n,src:a.file_path,preload:"metadata",className:"hidden"}),e.jsxs("div",{className:"bg-secondary/30 mb-4 rounded-lg p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-4",children:[e.jsx(p,{variant:"ghost",size:"icon",className:"bg-primary text-primary-foreground hover:bg-primary/90 h-10 w-10 rounded-full",onClick:h,children:f?e.jsx(re,{className:"h-5 w-5"}):e.jsx(ie,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex flex-1 items-center gap-3",children:[e.jsx("span",{className:"text-sm",children:o(g)}),e.jsx("input",{type:"range",min:"0",max:x||100,value:g,onChange:B,className:"bg-secondary h-2 flex-1 cursor-pointer appearance-none rounded-lg"}),e.jsx("span",{className:"text-sm",children:o(x||0)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:b,children:m?e.jsx(de,{className:"h-5 w-5"}):e.jsx(le,{className:"h-5 w-5"})}),e.jsx("input",{type:"range",min:"0",max:"100",value:N,onChange:F,className:"bg-secondary h-2 w-20 cursor-pointer appearance-none rounded-lg"})]})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(p,{className:"w-full sm:w-auto",onClick:()=>window.open(a.file_path,"_blank"),children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Download Audio"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"text-muted-foreground h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"flex-shrink-0 text-sm font-medium",children:"Job ID:"}),e.jsx("code",{className:"bg-secondary/50 rounded px-1.5 py-0.5 text-sm",children:a.id})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"text-muted-foreground h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"flex-shrink-0 text-sm font-medium",children:"User ID:"}),e.jsx("code",{className:"bg-secondary/50 rounded px-1.5 py-0.5 text-sm",children:a.user_id})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"text-muted-foreground h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"flex-shrink-0 text-sm font-medium",children:"Status:"}),e.jsx(O,{className:X("flex min-w-[100px] items-center justify-center rounded-md px-4 py-1 text-xs",z[a.status]||z.default),children:a.status.charAt(0).toUpperCase()+a.status.slice(1)})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"text-muted-foreground h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"flex-shrink-0 text-sm font-medium",children:"Created:"}),e.jsx("span",{className:"text-sm",children:new Date(a.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{className:"text-muted-foreground h-4 w-4 flex-shrink-0"}),e.jsx("span",{className:"flex-shrink-0 text-sm font-medium",children:"Updated:"}),e.jsx("span",{className:"text-sm",children:new Date(a.updated_at).toLocaleString()})]})]})]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"text-muted-foreground mt-1 h-4 w-4 flex-shrink-0"}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1 flex-shrink-0 text-sm font-medium",children:"Category:"}),e.jsx("code",{className:"bg-secondary/50 rounded px-2 py-1 text-sm break-all",children:a.prompt_category_id||"N/A"})]})})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"text-muted-foreground mt-1 h-4 w-4 flex-shrink-0"}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-1 flex-shrink-0 text-sm font-medium",children:"Subcategory:"}),e.jsx("code",{className:"bg-secondary/50 rounded px-2 py-1 text-sm break-all",children:a.prompt_subcategory_id||"N/A"})]})})]})]})]})]}),e.jsxs(W,{defaultValue:"transcription",className:"w-full",children:[e.jsxs(K,{className:"mb-4 grid grid-cols-2",children:[e.jsx(P,{value:"transcription",children:"Transcription"}),e.jsx(P,{value:"analysis",children:"Analysis"})]}),e.jsx(D,{value:"transcription",className:"mt-0",children:e.jsxs(T,{className:"border-0 bg-transparent shadow-none",children:[e.jsx(C,{className:"pb-3",children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-primary/10 rounded-full p-2",children:e.jsx($,{className:"text-primary h-5 w-5"})}),"Transcription"]})}),e.jsxs(S,{children:[y?e.jsx("div",{className:"mb-4 rounded-lg bg-gray-100 p-4 shadow-md dark:bg-gray-800",children:e.jsx("pre",{className:"text-sm whitespace-pre-wrap",children:y})}):e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"flex flex-col items-center justify-center rounded-lg bg-gray-100 p-4 py-8 shadow-md dark:bg-gray-800",children:[e.jsx("p",{className:"text-muted-foreground mb-6 text-center",children:"Transcription data is not loaded. Click the button below to load the transcription."}),e.jsx(p,{onClick:async()=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("No authentication token found");const t=await fetch(`${Q}/${a.id}`,{method:"GET",headers:{Authorization:`Bearer ${s}`}});if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);const i=await t.text();if(i&&i.length>0)l(i);else throw new Error("Received empty transcription")}catch(s){console.error("Error loading transcription:",s),s instanceof Error?s.message.includes("404")?l("Transcription not found for this recording."):s.message.includes("401")||s.message.includes("403")?l("Not authorized to access this transcription."):l("Unable to load transcription. Please try again later."):l("Unable to load transcription. Please try again later.")}},className:"px-8",children:"Load Transcription"})]})}),a.transcription_file_path&&e.jsx("div",{className:"flex justify-center",children:e.jsxs(p,{onClick:()=>a.transcription_file_path&&window.open(a.transcription_file_path,"_blank"),variant:"outline",className:"w-full max-w-md rounded-lg font-semibold shadow-md",disabled:!a.transcription_file_path,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Download Transcription TXT"]})})]})]})}),e.jsx(D,{value:"analysis",className:"mt-0",children:e.jsxs(T,{children:[e.jsx(C,{className:"pb-3",children:e.jsxs(E,{className:"flex items-center gap-2",children:[e.jsx("span",{className:"bg-primary/10 rounded-full p-2",children:e.jsx($,{className:"text-primary h-5 w-5"})}),"Analysis Summary"]})}),e.jsx(S,{children:a.analysis_text?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 rounded-lg bg-gray-100 p-4 shadow-md dark:bg-gray-800",children:a.analysis_text.split(`

`).map((s,t)=>{const i=s.split(`
`),w=i[0],U=i.slice(1);return e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-md font-semibold",children:w}),e.jsx("ul",{className:"mt-2 list-inside list-disc text-sm text-gray-700 dark:text-gray-300",children:U.map((V,H)=>e.jsx("li",{children:V},H))})]},t)})}),e.jsxs(p,{onClick:()=>a.analysis_file_path&&window.open(a.analysis_file_path,"_blank"),variant:"outline",className:"mt-2 w-full rounded-lg font-semibold shadow-md",disabled:!a.analysis_file_path,children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Download Analysis PDF"]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No analysis available for this recording."})})]})})]})]})})]})}function ue({id:a}){const c=M(),[y,l]=r.useState(null),[f,d]=r.useState(!0),[m,v]=r.useState(null),g=u=>{if(typeof window>"u")return null;try{return localStorage.getItem(u)}catch(x){return console.error("Error accessing localStorage:",x),null}};return r.useEffect(()=>{const u=g("current_recording_id"),x=u||a;u&&typeof window<"u"&&localStorage.removeItem("current_recording_id");const k=async n=>{try{const o=g("token");if(!o)throw new Error("Authentication required");const h=await fetch(`${Y}/${n}`,{method:"GET",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(h.ok){const b=await h.json();return l(b.job),d(!1),!0}return!1}catch(o){return console.error("Error fetching recording by ID:",o),!1}},N=()=>{try{const n=g("cachedJobs");if(n){const h=JSON.parse(n).find(b=>b.id===x);if(h)return l(h),d(!1),!0}return!1}catch(n){return console.error("Error parsing cached jobs:",n),!1}};(async()=>{N()||await k(x)||(v("Recording not found. Please try again from the recordings list."),d(!1),setTimeout(()=>{c.navigate({to:"/audio-recordings"})},3e3))})()},[a,c]),f?e.jsx("div",{className:"container mx-auto px-4 py-6",children:"Loading recording details..."}):m?e.jsx("div",{className:"container mx-auto px-4 py-6",children:e.jsxs("div",{className:"rounded border border-red-400 bg-red-100 px-4 py-3 text-red-700",children:[e.jsx("p",{children:m}),e.jsx("p",{className:"mt-2",children:e.jsx("button",{onClick:()=>c.navigate({to:"/audio-recordings"}),className:"text-blue-500 underline",children:"Return to recordings list"})})]})}):y?e.jsx(me,{recording:y}):e.jsx("div",{className:"container mx-auto px-4 py-6",children:"Recording not found"})}const be=function(){const{id:c}=J({from:"/_layout/audio-recordings/$id"});return e.jsx(ue,{id:c})};export{be as component};
