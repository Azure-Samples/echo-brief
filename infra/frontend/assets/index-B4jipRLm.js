import{r as u,j as e}from"./index-CDPrMl7K.js";import{a as J,b as M,B as P}from"./button-DKvy1mVZ.js";import{C as A,b as H,c as L,d as q,a as D}from"./card-93D8wC93.js";import{u as B,F as $,a as S,b as k,c as F,d as C,g as z,e as N,s as G,o as K,f as E,i as X}from"./form-KLlgSuy3.js";import{I as Q}from"./input-DnHtobcv.js";import{X as W,S as O,a as T,b as I,d as U,e as R}from"./select-DVPCXNqQ.js";import{h as Y,i as Z,L as ee}from"./api-OWpTAIJf.js";import{R as re}from"./refresh-ccw-BDVVl8SQ.js";import{u as se,r as te,k as oe,V as ae,l as ne,v as le,t as ie,m as v,q as ce}from"./index-dxv_gAgu.js";import"./apiConstants-5F4MNVxx.js";const me=M("fixed top-4 left-1/2 flex w-full max-w-sm -translate-x-1/2 transform items-center justify-between rounded-lg p-4 text-white shadow-lg",{variants:{variant:{success:"bg-green-500",error:"bg-red-500"}},defaultVariants:{variant:"success"}});function de({className:t,variant:r,message:n,onClose:l,autoHideDuration:d=5e3,...f}){const[y,g]=u.useState(!0);return u.useEffect(()=>{const h=setTimeout(()=>{g(!1),l==null||l()},d);return()=>clearTimeout(h)},[d,l]),y?e.jsxs("div",{className:J(me({variant:r}),t),...f,children:[e.jsx("span",{children:n}),e.jsx("button",{onClick:()=>{g(!1),l==null||l()},className:"ml-4 rounded-full p-1 transition-colors hover:bg-white/20","aria-label":"Close notification",children:e.jsx(W,{className:"h-4 w-4"})})]}):null}const ue="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",_=[],V={allowDangerousHtml:!0},pe=/^(https?|ircs?|mailto|xmpp)$/i,fe=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function ge(t){const r=he(t),n=xe(t);return ye(r.runSync(r.parse(n),n),t)}function he(t){const r=t.rehypePlugins||_,n=t.remarkPlugins||_,l=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...V}:V;return se().use(te).use(n).use(oe,l).use(r)}function xe(t){const r=t.children||"",n=new ae;return typeof r=="string"&&(n.value=r),n}function ye(t,r){const n=r.allowedElements,l=r.allowElement,d=r.components,f=r.disallowedElements,y=r.skipHtml,g=r.unwrapDisallowed,h=r.urlTransform||je;for(const o of fe)Object.hasOwn(r,o.from)&&ne("Unexpected `"+o.from+"` prop, "+(o.to?"use `"+o.to+"` instead":"remove it")+" (see <"+ue+"#"+o.id+"> for more info)");return le(t,j),ie(t,{Fragment:e.Fragment,components:d,ignoreInvalidStyle:!0,jsx:e.jsx,jsxs:e.jsxs,passKeys:!0,passNode:!0});function j(o,c,i){if(o.type==="raw"&&i&&typeof c=="number")return y?i.children.splice(c,1):i.children[c]={type:"text",value:o.value},c;if(o.type==="element"){let m;for(m in v)if(Object.hasOwn(v,m)&&Object.hasOwn(o.properties,m)){const b=o.properties[m],p=v[m];(p===null||p.includes(o.tagName))&&(o.properties[m]=h(String(b||""),m,o))}}if(o.type==="element"){let m=n?!n.includes(o.tagName):f?f.includes(o.tagName):!1;if(!m&&l&&typeof c=="number"&&(m=!l(o,c,i)),m&&i&&typeof c=="number")return g&&o.children?i.children.splice(c,1,...o.children):i.children.splice(c,1),c}}}function je(t){const r=t.indexOf(":"),n=t.indexOf("?"),l=t.indexOf("#"),d=t.indexOf("/");return r===-1||d!==-1&&r>d||n!==-1&&r>n||l!==-1&&r>l||pe.test(t.slice(0,r))?t:""}const be=K({audioFile:X(File),promptCategory:E({required_error:"Please select a prompt category."}),promptSubcategory:E({required_error:"Please select a prompt subcategory."})});function we(){const[t,r]=u.useState([]),[n,l]=u.useState(null),[d,f]=u.useState(null),[y,g]=u.useState(!1),[h,j]=u.useState(!0),[o,c]=u.useState(null),i=B({resolver:G(be)}),m=u.useCallback(()=>{j(!0),Y().then(a=>{const s=a.data;r(s),localStorage.setItem("promptCategories",JSON.stringify(s)),j(!1)}).catch(a=>{console.error("Error fetching prompts:",a),c({type:"error",message:"Failed to load prompt categories. Please try again later."}),j(!1)})},[]);u.useEffect(()=>{const a=localStorage.getItem("promptCategories");a?(r(JSON.parse(a)),j(!1)):m()},[m]);const b=u.useCallback(async a=>{g(!0);try{const s=localStorage.getItem("token");if(!s)throw new Error("No authentication token found. Please log in again.");const x=await Z(a.audioFile,a.promptCategory,a.promptSubcategory,s);c({type:"success",message:`File ${a.audioFile.name} uploaded successfully! Job ID: ${x.job_id}`}),i.reset(),l(null),f(null)}catch(s){console.error("Error in form submission:",s);let x="There was an error uploading your file. Please try again.";s instanceof Error&&(x=s.message),c({type:"error",message:x})}finally{g(!1)}},[i]),p=t.find(a=>a.category_id===n),w=p==null?void 0:p.subcategories.find(a=>a.subcategory_id===d);return e.jsxs(e.Fragment,{children:[o&&e.jsx(de,{variant:o.type,message:o.message,onClose:()=>c(null)}),e.jsx($,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(b),className:"space-y-8",children:[e.jsx(S,{control:i.control,name:"audioFile",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Audio File"}),e.jsx(C,{children:e.jsx(Q,{type:"file",accept:"audio/*",onChange:s=>{var x;a.onChange((x=s.target.files)==null?void 0:x[0])}})}),e.jsx(z,{children:"Upload an audio file (no size limit)"}),e.jsx(N,{})]})}),e.jsx(S,{control:i.control,name:"promptCategory",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Prompt Category"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(O,{value:n||"",onValueChange:s=>{a.onChange(s),l(s),f(null),i.setValue("promptSubcategory","")},disabled:h,children:[e.jsx(C,{children:e.jsx(T,{children:e.jsx(I,{placeholder:"Select a category"})})}),e.jsx(U,{children:t.map(s=>e.jsx(R,{value:s.category_id,children:s.category_name},s.category_id))})]}),e.jsxs(P,{type:"button",variant:"outline",onClick:m,disabled:h,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),h?"Refreshing...":"Refresh"]})]}),e.jsx(N,{})]})}),e.jsx(S,{control:i.control,name:"promptSubcategory",render:({field:a})=>e.jsxs(k,{children:[e.jsx(F,{children:"Prompt Subcategory"}),e.jsxs(O,{value:d||"",onValueChange:s=>{a.onChange(s),f(s)},disabled:!n,children:[e.jsx(C,{children:e.jsx(T,{children:e.jsx(I,{placeholder:"Select a subcategory"})})}),e.jsx(U,{children:p==null?void 0:p.subcategories.map(s=>e.jsx(R,{value:s.subcategory_id,children:s.subcategory_name},s.subcategory_id))})]}),e.jsx(N,{})]})}),w&&e.jsxs(A,{children:[e.jsxs(H,{children:[e.jsx(L,{className:"font-bold",children:w.subcategory_name}),e.jsx(q,{children:"Prompt details for the selected subcategory"})]}),e.jsx(D,{className:"max-h-60 overflow-auto p-4",children:Object.entries(w.prompts).map(([a,s])=>e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:a}),e.jsx(ge,{remarkPlugins:[ce],children:s})]},a))})]}),e.jsx(P,{type:"submit",disabled:y||!i.formState.isValid,children:y?e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}):"Upload and Process"})]})})]})}const Ie=function(){return e.jsxs("div",{className:"flex-1 space-y-4 p-4 pt-6 md:p-8",children:[e.jsx("h2",{className:"text-3xl font-bold tracking-tight",children:"Audio Upload"}),e.jsxs(A,{children:[e.jsxs(H,{children:[e.jsx(L,{children:"Upload Audio File"}),e.jsx(q,{children:"Upload an audio file and select prompts for processing"})]}),e.jsx(D,{children:e.jsx(we,{})})]})]})};export{Ie as component};
